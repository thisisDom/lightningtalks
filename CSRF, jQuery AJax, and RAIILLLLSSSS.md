## jQuery AJax, CSRF, and RAIILLLLSSSS


### JQUERY AJAX & UJS(Unobstrusive Javascript)

Unobstrusive Javascript is a way of using JavaScript to progressively enhance the user experience for capable browsers without negatively impacting clients that do not support or do not enable JavaScript.

jquery-ujs wires event handlers to eligible DOM elements, mostly identified by HTML5 data attributes, to provide enhanced functionality. 

#### Before UJS
```html

<a href="#" onclick="this.style.backgroundColor='#990000'">Paint it red</a>
<a href="#" onclick="this.style.backgroundColor='#009900';this.style.color='#FFFFFF';">Paint it green</a>

```

#### AFTER UJS
```CoffeeScript
  
@paintIt = (element, backgroundColor, textColor) ->
  element.style.backgroundColor = backgroundColor
  if textColor?
    element.style.color = textColor
 
$ ->
  $("a[data-background-color]").click (e) ->
    e.preventDefault()
 
    backgroundColor = $(this).data("background-color")
    textColor = $(this).data("text-color")
    paintIt(this, backgroundColor, textColor)
```
```html

<a href="#" data-background-color="#990000">Paint it red</a>
<a href="#" data-background-color="#009900" data-text-color="#FFFFFF">Paint it green</a>

```

#### POST, PUT, DELETE Links

```
<%= link_to 'Delete', item, method: :delete %>
```

Jquery-ujs attaches a handler to links with the data-method attribute. When the link is clicked, the handler constructs an HTML form along with a hidden input that sets the _method parameter to the requested HTTP verb and submits the form rather than following the link.


#### Confirmation Dialogs

```
<%= form_for item, data: { confirm: 'Are you sure?' } %>
```

Jquery-ujs attaches a handler to links or forms with the data-confirm attribute that displays a JavaScript confirmation dialog.

#### Disabling Links and Buttons

```
<%= form.submit data: { disable_with: 'Submitting...' } %>
```

Links and buttons that have a data-disable-with attribute get a click handler that disables the element and updates the text of the button to that which was provided in the data attribute and disables the button. If the action is performed via AJAX, the handler will re-enable the button and reset the text when the request completes.

#### AJAX Forms

```
<%= form_for item, remote: true %>
```

Adding remote: true to your form_for calls in Rails causes jquery-ujs to handle the form submission as an AJAX request. Your controller can handle the AJAX request and return JavaScript to be executed in the response. Thanks to jquery-ujs and Railsâ€™ respond_with, setting remote: true is likely the quickest way to get your Rails application making AJAX requests.


#### Extensibility

Jquery-ujs exposes its functions in the $.rails namespace and fires many events when submitting AJAX form


### What is CSRF?

CSRF stands for Cross Site Request Forgery. It's a type of application attack method that works by including malicious code or a link in a page that accesses a web application that the user is believed to have authenticated. If the session for that web application has not timed out, an attacker may execute unauthorized commands.

Example 1.
![CSRF Example](http://guides.rubyonrails.org/images/csrf.png)



Rails has a few built in countermeasures to help protect an application from these kind of attacks.

##### 1. Disallowing cross-site <script> tags
```html

<a href="http://www.harmless.com/" onclick="
  var f = document.createElement('form');
  f.style.display = 'none';
  this.parentNode.appendChild(f);
  f.method = 'POST';
  f.action = 'http://www.example.com/account/destroy';
  f.submit();
  return false;">To the harmless survey</a>

```

###### 2. Required Security Token for HTTP Protocol Requests

```ruby

class ApplicationController < ActionController::Base
  protect_from_forgery with: :exception
end

class SomeClass < ApplicationController
end
```

This helper method automatically include a security token in all forms and Ajax requests generated by Rails. If the security token doesn't match what was expected, an exception will be thrown.

By default, Rails includes an unobtrusive scripting adapter, which adds a header called X-CSRF-Token with the security token on every non-GET Ajax call. Without this header, non-GET Ajax requests won't be accepted by Rails.

When using another library to make Ajax calls, it is necessary to add the security token as a default header for Ajax calls in your library. To get the token, use <%= csrf_meta_tags %> in your application create this tag: <meta name='csrf-token' content='THE-TOKEN'>.

In collaboration with <%= csrf_meta_tags %> in your application layout HEAD, jquery-ujs augments this protection by adding the CSRF token to a header on outgoing AJAX requests.
Jquery-ujs also updates the CSRF token on all non-AJAX forms on page load, which may be out-of-date if the form was rendered from a fragment cache

**Note that cross-site scripting (XSS) vulnerabilities bypass all CSRF protections. XSS gives the attacker access to all elements on a page, so they can read the CSRF security token from a form or directly submit the form**


source: http://guides.rubyonrails.org/security.html#cross-site-request-forgery-csrf     
source: https://robots.thoughtbot.com/a-tour-of-rails-jquery-ujs

## :100: :100: :100: :100: :100: :100: :100: :100: :100:
